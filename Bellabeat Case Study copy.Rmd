---
title: "Google Analytics Case Study"
author: "Joe Gorrino"
date: "2024-09-04"
output:html_document: default
 
---

## Bellabeat Case Study

## Buisness Task 
Analyze non-Bellabeat smart device data to gain insight into how consumers are using their smart devices and answer the following business questions:

1. What are some trends in smart device usage? 
2. How could these trends apply to Bellabeat customers?
3. How could these trends help influence Bellabeat marketing strategy?


## Discription of Data Source 

[FitBit Fitness Tracker data](https://www.kaggle.com/datasets/arashnic/fitbit)
This dataset generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. For our analysis we will be using the following datasets for the time period 3.12.16-4.12.16:

1. dailyActivity_merged
2. minuteSleep-merged
3. weightLoginfo_merged

These three datasets were chosen specifically as all other relate directly to these three.


## Preparing the data 

Load the necessary packages

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library("tidyverse")
library("readr")
library("dplyr")
library("lubridate")
library("ggplot2")
library("patchwork")
```

Load the data to be analyzed
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
daily_activity_df <- read_csv("dailyActivity_merged.csv")
minuteSleep_df <- read_csv("minuteSleep_merged.csv")
weightLogInfo_df <- read_csv("weightLogInfo_merged.csv")
```

Brief overview of each data set and its columns
```{r}
colnames(daily_activity_df)

colnames(minuteSleep_df)

colnames(weightLogInfo_df)
```

Further review of the structure of each data frame
```{r}
str(daily_activity_df)

str(minuteSleep_df)

str(weightLogInfo_df)
```


All three data frames contain "Id", and a date in some form.  We will use these two columns to create a final data set. 

Counting the unique identifiers in the ID column to verify individual users.
```{r}
daily_unique_id <- length(unique(daily_activity_df$Id))
daily_unique_id
```
This creates a question as data source states 30 users. Further investigation to verify unique IDs
```{r message=FALSE}
daily_unique_values_id <- unique(daily_activity_df$Id)
daily_unique_values_id
```
As Ids have been identified as unique and a count of 35, further investigation on the frequency each ID appears to look for any incorrect ID, or NULL value, by counting how often each unique ID occurs.
```{r}
 daily_values_count_id <- table(daily_activity_df$Id)

 daily_values_count_id
```
We will repeat the same process with the other data frames
```{r}
minute_unique_values <- unique(minuteSleep_df$Id)
minute_unique_values
minutes_value_count_id <- table(minuteSleep_df$Id)
minutes_value_count_id
```
23 unique IDs in the MinuteSleep DF
```{r}
weight_unique_values <- unique(weightLogInfo_df$Id)
weight_unique_values
weight_value_count_id <- table(weightLogInfo_df$Id)
weight_value_count_id
```
11 unique Ids in the weight data frame. 

### Prepare to merge all three data bases to prepare for analysis.

Using the daily activity data set: Rename ActivityDate column to Date so that we can more easily merge the data frames
```{r}
# Rename the column "ActivityDate" to "Date"
daily_activity_df <- daily_activity_df %>% rename(Date = ActivityDate)

# View the updated data frame
daily_activity_df


```
Rework the Date column to remove time to more easily merge. Sum total minutes slept to new column "Hours_Slept" and grouped by "Id" and "Date"
```{r}
# Rename to column "date" to "Date" as R is case sensitive
minuteSleep_df <- minuteSleep_df %>% 
  rename(Date=date)

# Convert the 'Date' column to Date type (ignore time)
minuteSleep_df <- minuteSleep_df %>%
  mutate(Date = as.Date(Date, format="%m/%d/%Y"))

# Group by 'Id' and the new 'Date' column, and sum the 'value' column
minuteSleep_simplified_df <- minuteSleep_df %>%
  group_by(Id, Date) %>%
  summarise(Hours_Slept = sum(value)/60)

# Corrected MM-DD-YYYY format to match daily_activity_df
minuteSleep_simplified_df <- minuteSleep_simplified_df %>% 
  mutate(Date = format(Date,"%m/%d/%Y"))

# View the simplified data frame
minuteSleep_simplified_df

```
Reformated Date Column to remove time.
```{r}
weightLogInfo_df<-weightLogInfo_df %>% 
  mutate(Date = as.Date(Date, format="%m/%d/%Y")) %>% 
  mutate(Date = format(Date,"%m/%d/%Y"))

weightLogInfo_df

```
### Merge Data Frames
```{r}
# Combine daily_activity_df with minuteSleep_simplified_df
merged_df12 <- merge(daily_activity_df, minuteSleep_simplified_df, by = c("Id","Date"),all = TRUE)

#Add in weightLogInfo_df
final_df <- merge(merged_df12, weightLogInfo_df, by = c("Id", "Date"), all = TRUE)

#View final_df before analysis
head(final_df)


```
## Analysis of the Data

First, we looked at the number of entries (days) Users recorded their "Step" Activity.

```{r}
# Count the number of entries in 'TotalSteps' for each 'Id'
entry_counts <- final_df %>%
  group_by(Id) %>%
  summarise(Entries = sum(!is.na(TotalSteps))) %>%
  arrange(desc(Entries))  # Arrange in descending order of Entries

# Create a new variable for the number of users 
entry_counts <- entry_counts %>%
  mutate(UserNumber = row_number()) 

# Plotting the counts with ggplot2 as a scatter plot
ggplot(entry_counts, aes(x = UserNumber, y = Entries)) +
  geom_line(color = "orange") +
  labs(title = "Number of Entries by User",
       x = "Number of Users",
       y = "Number of Step Days Entered") +
  theme_minimal()


```


Next, I wanted to see the Average Days users recorded "Steps."
```{r}


# Count the number of entries in 'TotalSteps' for each 'Id'
entry_counts <- final_df %>%
  group_by(Id) %>%
  summarise(Entries = sum(!is.na(TotalSteps))) %>%
  arrange(desc(Entries))  # Arrange in descending order of Entries

# Create a new variable for the number of users 
entry_counts <- entry_counts %>%
  mutate(UserNumber = row_number())  

# Calculate the average number of entries
average_entries <- mean(entry_counts$Entries, na.rm = TRUE)

# Plotting the counts with ggplot2 as a scatter plot and adding average line
ggplot(entry_counts, aes(x = UserNumber, y = Entries)) +
  geom_point(color = "orange") +
  geom_line(color = "orange") +  # Line connecting points
  geom_hline(yintercept = average_entries, linetype = "dashed", color = "red") +
  labs(title = "Number of Step Entries by User",
       x = "Number of Users",
       y = "Number of Step Days Entered") +
  theme_minimal() +
  annotate("text", x = max(entry_counts$UserNumber), y = average_entries,
           label = paste("Average # of Entries:", round(average_entries, 2)),
           color = "red", vjust = -1, hjust = 1)

```


Then, I repeated this with how often Users recorded their "Hours Slept"
```{r}
# Count the number of entries in 'Hours_Slept' for each 'Id'
entry_counts <- final_df %>%
  group_by(Id) %>%
  summarise(Entries = sum(!is.na(Hours_Slept))) %>%
  arrange(desc(Entries))  # Arrange in descending order of Entries

# Create a new variable for the number of users 
entry_counts <- entry_counts %>%
  mutate(UserNumber = row_number())  

# Calculate the average number of entries
average_entries <- mean(entry_counts$Entries, na.rm = TRUE)

# Plotting the counts with ggplot2 as a scatter plot and adding average line
ggplot(entry_counts, aes(x = UserNumber, y = Entries)) +
  geom_point(color = "blue") +
  geom_line(color = "blue") +  # Line connecting points
  geom_hline(yintercept = average_entries, linetype = "dashed", color = "red") +
  labs(title = "Number of Sleep Entries by User",
       x = "Number of Users",
       y = "Number of Sleep Days Entered") +
  theme_minimal() +
  annotate("text", x = max(entry_counts$UserNumber), y = average_entries,
           label = paste("Average # of Entries:", round(average_entries, 2)),
           color = "red", vjust = -1, hjust = 1)

```


Lastly, we looked at "Weight" entries for each User.
```{r}
# Count the number of entries in 'WeightPounds' for each 'Id'
entry_counts <- final_df %>%
  group_by(Id) %>%
  summarise(Entries = sum(!is.na(WeightPounds))) %>%
  arrange(desc(Entries))  # Arrange in descending order of Entries

# Create a new variable for the number of users 
entry_counts <- entry_counts %>%
  mutate(UserNumber = row_number())  

# Calculate the average number of entries
average_entries <- mean(entry_counts$Entries, na.rm = TRUE)

# Plotting the counts with ggplot2 as a scatter plot and adding average line
ggplot(entry_counts, aes(x = UserNumber, y = Entries)) +
  geom_point(color = "green") +
  geom_line(color = "green") +  # Line connecting points
  geom_hline(yintercept = average_entries, linetype = "dashed", color = "red") +
  labs(title = "Number of Weight Entries by User",
       x = "Number of Users",
       y = "Number of Weight Entries") +
  theme_minimal() +
  annotate("text", x = max(entry_counts$UserNumber), y = average_entries,
           label = paste("Average # of Entries:", round(average_entries, 2)),
           color = "red", vjust = -1, hjust = 1)

```


Next, I wanted to look at all three together to see if there was any  correlations.
```{r}
# Create the data for each metric
steps_data <- final_df %>%
  group_by(Id) %>%
  summarise(Entries = sum(!is.na(TotalSteps))) %>%
  arrange(desc(Entries)) %>%
  mutate(UserNumber = row_number())

sleep_data <- final_df %>%
  group_by(Id) %>%
  summarise(Entries = sum(!is.na(Hours_Slept))) %>%
  arrange(desc(Entries)) %>%
  mutate(UserNumber = row_number())

weight_data <- final_df %>%
  group_by(Id) %>%
  summarise(Entries = sum(!is.na(WeightPounds))) %>%
  arrange(desc(Entries)) %>%
  mutate(UserNumber = row_number())

# Plot all three datasets on the same plot
ggplot() +
  # TotalSteps line
  geom_line(data = steps_data, aes(x = UserNumber, y = Entries, color = "TotalSteps")) +
  # Hours_Slept line
  geom_line(data = sleep_data, aes(x = UserNumber, y = Entries, color = "Hours_Slept"))  +
  # WeightPounds line
  geom_line(data = weight_data, aes(x = UserNumber, y = Entries, color = "WeightPounds")) +
  
  # Labels and theme
  labs(title = "Number of Entries by User for Steps, Sleep, and Weight",
       x = "Number of Users",
       y = "Number of Entries",
       color = "Metric") +
  theme_minimal()

```


I also looked at the percentage of users who had at least one data entry in 1, 2, or all 3 categories.

```{r}
# Create a new dataframe with information on how many categories each user has data in
user_data <- final_df %>%
  group_by(Id) %>%
  summarise(
    HasTotalSteps = !all(is.na(TotalSteps)),
    HasHoursSlept = !all(is.na(Hours_Slept)),
    HasWeightPounds = !all(is.na(WeightPounds))
  ) %>%
  mutate(CategoriesWithData = HasTotalSteps + HasHoursSlept + HasWeightPounds)

# Summarize the number of users for each level of data availability
category_counts <- user_data %>%
  group_by(CategoriesWithData) %>%
  summarise(UserCount = n()) %>%
  ungroup()

# Calculate percentage of users in each category
total_users <- sum(category_counts$UserCount)
category_counts <- category_counts %>%
  mutate(
    Percentage = (UserCount / total_users) * 100,
    Label = case_when(
      CategoriesWithData == 3 ~ "All 3 Categories",
      CategoriesWithData == 2 ~ "2 Categories",
      CategoriesWithData == 1 ~ "1 Category"
    )
  )

# Plot the pie chart with percentages
ggplot(category_counts, aes(x = "", y = UserCount, fill = Label)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  labs(title = "Distribution of Users by Data Availability") +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        panel.grid = element_blank(),
        axis.ticks = element_blank()) +
  scale_fill_manual(values = c("All 3 Categories" = "green", 
                               "2 Categories" = "orange", 
                               "1 Category" = "red")) +
  geom_text(aes(label = paste0(round(Percentage, 1), "%")),
            position = position_stack(vjust = 0.5), size = 5)

```


Next, I wanted to look at who had the most data entries. People who where using all data points or only one or two? 

```{r}
# Calculate total entries for each user in each category
user_data <- final_df %>%
  group_by(Id) %>%
  summarise(
    TotalStepsEntries = sum(!is.na(TotalSteps), na.rm = TRUE),
    HoursSleptEntries = sum(!is.na(Hours_Slept), na.rm = TRUE),
    WeightPoundsEntries = sum(!is.na(WeightPounds), na.rm = TRUE)
  ) %>%
  # Count how many categories have data (1, 2, or 3)
  mutate(
    CategoriesWithData = (TotalStepsEntries > 0) + (HoursSleptEntries > 0) + (WeightPoundsEntries > 0),
    TotalEntries = TotalStepsEntries + HoursSleptEntries + WeightPoundsEntries
  )

# Calculate the average number of entries per user in each category (1, 2, or 3)
avg_entries_per_category <- user_data %>%
  group_by(CategoriesWithData) %>%
  summarise(AverageEntries = mean(TotalEntries)) %>%
  mutate(
    Label = case_when(
      CategoriesWithData == 3 ~ "All 3 Categories",
      CategoriesWithData == 2 ~ "2 Categories",
      CategoriesWithData == 1 ~ "1 Category"
    )
  )

# Plot the average entries per category with total numbers overlayed
ggplot(avg_entries_per_category, aes(x = Label, y = AverageEntries, fill = Label)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = round(AverageEntries, 1)), vjust = -0.5, size = 5) +  # Overlay total number on each bar
  labs(title = "Average Number of Entries per User by Data Categories",
       x = "Number of Categories with Data",
       y = "Average Number of Entries") +
  theme_minimal() +
  scale_fill_manual(values = c("All 3 Categories" = "green", 
                               "2 Categories" = "orange", 
                               "1 Category" = "red"))

```

Lastly, I wanted to see in what combination the data was being recorded.
```{r}

# Create a new dataframe with information on how many categories each user has data in
user_data <- final_df %>%
  group_by(Id) %>%
  summarise(
    HasTotalSteps = sum(!is.na(TotalSteps)) > 0,
    HasHoursSlept = sum(!is.na(Hours_Slept)) > 0,
    HasWeightPounds = sum(!is.na(WeightPounds)) > 0
  ) %>%
  # Create a new column that categorizes users based on their data availability
  mutate(
    Category = case_when(
      HasTotalSteps & HasHoursSlept & !HasWeightPounds ~ "Steps & Sleep",
      HasTotalSteps & !HasHoursSlept & HasWeightPounds ~ "Steps & Weight",
      !HasTotalSteps & HasHoursSlept & HasWeightPounds ~ "Weight & Sleep",  # New condition
      HasTotalSteps & HasHoursSlept & HasWeightPounds ~ "All 3 Categories",
      TRUE ~ "Other"
    )
  )

# Filter out the "Other" category since we only want specific combinations
user_data_filtered <- user_data %>%
  filter(Category != "Other")

# Summarize the count of users in each category
category_counts <- user_data_filtered %>%
  group_by(Category) %>%
  summarise(UserCount = n())

# Plot the column chart
ggplot(category_counts, aes(x = Category, y = UserCount, fill = Category)) +
  geom_col(width = 0.7) +
  labs(title = "Users by Data Availability",
       x = "Data Categories",
       y = "Number of Users") +
  theme_minimal() +
  scale_fill_manual(values = c("Steps & Sleep" = "orange", 
                               "Steps & Weight" = "blue", 
                               "Weight & Sleep" = "purple",  # New color for the new category
                               "All 3 Categories" = "green"))



```

## Key Findings


1) Data set validity in question.  Description lists fewer users then found during analysis bringing into question the quality of the data.  For this excercise we will continue with the analysis.

2) Step - All users recorded at least one day of step data: 100%. The average entry per user was 13.06.

3) Sleep - 23 users recorded sleep data: 66% of all users. The average entry per user was 13.34.

4) Weight - 11 users recorded weight data: 31% of all users. The average entry per user was .94.

5) Only 23% of User only recorded step data with 57% of users using the device for something additional.

6) 20% of users recorded data in all 3 categories.

7) Users who recorded data in all 3 categories had  3x times as many entries as those who just recorded steps.


## Buisness Questions and Recommendations

1. What are some trends in smart device usage?

- Users primary interface is with the wearable device to count steps and secondarily to record sleep.
- Users far less often record their weight in the app.
- Users are less likely to use all three functions then to only record step data.

2. How could these trends apply to Bellabeat customers?

- Encourage Users to record weight via a wifi-connect Smart Scale via app reminders.
- Remind users to record Hydrations via SPRING or App. 
- Sleep reminders via wearble device

3. How could these trends help infuence Bellabeat marketing strategy?

- As the data shows Users primarily interact via wearable device and are more less likely to use the app as primary interface. Marketing can focus on the the many options customers have to track data and ease of use.
- Focus on the the diveristy of the product line:

- TIME - can be used as a daily wearable to track steps. Which is users primary focus.
- LEAF - the options in which this can be worn could tap into customers who arent as of yet tracking sleep with the     wrist based device.
- SPRING - offers passive tracking of hydration. A feature FitBit does not offer.
  
